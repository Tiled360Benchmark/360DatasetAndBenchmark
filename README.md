# Hardware Encoding Benchmark

This repository contains the software developped for the paper *Benchmarking Hardware Encoding for Live 360° Video Tiled Streaming Using a Novel Long-duration 8K Dataset*.

[Access the data generated during this benchmark](https://github.com/Tiled360Benchmark/BenchmarkData).

If you use any part of this repository, please [cite our work](#citation).

## Installation

To run the [benchmark](#benchmark) :

1. Install [FFmpeg 7.1](https://ffmpeg.org/).
1. Install [Powershell 7](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell).
1. To run the [Spatial and Temporal Information experiment](#spatial-and-temporal-information), also install [siti-tools](https://github.com/VQEG/siti-tools#requirements).

To generate the [plots](#plots) :

1. [Install the uv package manager](https://docs.astral.sh/uv/getting-started/installation/). It will download the right version of Python automatically.
1. Install the required Python packages using `uv sync`.

## Benchmark

A description of each script parameters is available inside the script.

### Spatial and Temporal Information

This script calculates the spatial and temporal information of videos according to the [ITU-T P.910 (07/2022) recommendation](https://www.itu.int/rec/T-REC-P.910-202207-I/en) using the [reference software](https://github.com/VQEG/siti-tools).

```powershell
siTi.ps1 -tiles "tile1.y4m", "tile2.y4m" -resultsFile sitiTiles.csv
```

### Bitrate, Visual Quality and Segment's Encoding Time Benchmark

This script evaluates the bitrate, visual quality and the segment's encoding time of videos with different encoding parameters.
First, generate the tasks to be performed.

```powershell
bitrateVmafSegmentsEncodingTimeTasks.ps1 -tiles "tile1.y4m", "tile2.y4m" -codecs "h264_nvenc", "hevc_nvenc" -presets p1, p2 -qps 18, 20 -heights 0, 320 -outputFile tasks.csv
```

Then, start the benchmark.

```powershell
bitrateVmafSegmentsEncodingTime.ps1 -inputFile tasks.csv -segmentTime 2 -segmentGOP 60 -logsDirectory ".\logs" -outputFile bitrateVmafSegmentsEncodingTime.csv
```

If the benchmark stops for any reason, you may restart it again by using the incomplete output file (here `bitrateVmafSegmentsEncodingTime.csv`) as the input file.
The script will automatically resume the execution of the remaining tasks.

### Total Encoding Time Benchmark

This script evaluates the time needed to segment and encode the videos with different encoding parameters.
First, generate the tasks to be performed.

```powershell
totalEncodingTimeTasks.ps1 -tiles "tile1.y4m", "tile2.y4m" -codecs "h264_nvenc", "hevc_nvenc" -presets p1, p2 -qps 18, 20 -heights 0, 320 -repetitions 5 -outputFile tasks.csv
```

Then, start the benchmark.

```powershell
totalEncodingTime.ps1 -inputFile tasks.csv -segmentTime 2 -segmentGOP 60 -outputFile totalEncodingTime.csv
```

If the benchmark stops for any reason, you may restart it again by using the incomplete output file (here `totalEncodingTime.csv`) as the input file.
The script will automatically resume the execution of the remaining tasks.

## Plots

These scripts plot the primary data generated by the experiments.
The following analyses are available :

- Bjøntegaard-Delta rate (`plotBdRate.py`)
- Encoding speed (`plotEncodingSpeed.py`)
- Spatial and temporal information (`plotSiTi.py`)

For usage, see each script in the `analysis` directory.

## Citation

To be added after acceptance.

## References

Bjøntegaard-Delta metrics calculation adapted from https://github.com/Anserw/Bjontegaard_metric
